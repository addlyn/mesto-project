/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function c(e){var t=e.closest(".popup__form").querySelector(".popup__input-error_".concat(e.name));e.classList.remove("popup__input_type_error"),t.textContent="",t.classList.remove("popup__input-error_active")}function u(e){e.validity.valid?c(e):function(e,t){var n=e.closest(".popup__form").querySelector(".popup__input-error_".concat(e.name));e.classList.add("popup__input_type_error"),n.textContent=t,n.classList.add("popup__input-error_active")}(e,e.validationMessage)}function i(e,t,n,r,o,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__image"),a=u.querySelector(".card__title"),l=u.querySelector(".card__like-button"),p=u.querySelector(".card__delete-button"),s=u.querySelector(".card__like-counter");s.textContent=e.likes.length;var d=e.likes.find((function(e){return e._id===t}));return t!==e.owner._id&&p.remove(),d&&l.classList.add("card__like-button_is-active"),i.src=e.link,i.alt=e.name,a.textContent=e.name,l.addEventListener("click",(function(){d?c(e._id).then((function(e){console.log(e),d=!1,l.classList.remove("card__like-button_is-active"),s.textContent=e.likes.length})).catch((function(e){return console.warn(e)})):n(e._id).then((function(e){console.log(e),d=!0,l.classList.add("card__like-button_is-active"),s.textContent=e.likes.length})).catch((function(e){return console.warn(e)}))})),p&&p.addEventListener("click",(function(){r(e._id).then((function(e){console.log(e),u.remove()})).catch((function(e){return console.warn(e)}))})),i.addEventListener("click",(function(){o(e)})),u}function a(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&p(t)}}function l(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function p(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}var s=new(n((function e(t){var n=this,o=t.baseUrl,c=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"_checkResponse",(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),r(this,"getUserInfo",(function(){return fetch("".concat(n._baseUrl,"/users/me"),{headers:n._headers}).then(n._checkResponse)})),r(this,"getInitialCards",(function(){return fetch("".concat(n._baseUrl,"/cards"),{headers:n._headers}).then(n._checkResponse)})),r(this,"editProfile",(function(e){var t=e.name,r=e.about;return fetch("".concat(n._baseUrl,"/users/me"),{method:"PATCH",headers:n._headers,body:JSON.stringify({name:t,about:r})}).then(n._checkResponse)})),r(this,"addNewCard",(function(e){var t=e.name,r=e.link;return fetch("".concat(n._baseUrl,"/cards"),{method:"POST",headers:n._headers,body:JSON.stringify({name:t,link:r})}).then(n._checkResponse)})),r(this,"removeCard",(function(e){return fetch("".concat(n._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n._headers}).then(n._checkResponse)})),r(this,"likeCard",(function(e){return fetch("".concat(n._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n._headers}).then(n._checkResponse)})),r(this,"unLikeCard",(function(e){return fetch("".concat(n._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n._headers}).then(n._checkResponse)})),r(this,"updateAvatar",(function(e){return fetch("".concat(n._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n._headers,body:JSON.stringify({avatar:e})}).then(n._checkResponse)})),this._baseUrl=o,this._headers=c})))({baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"c48e611f-29c1-4a31-ba04-0a959f4c7417","Content-Type":"application/json"}}),d={_id:null},_=document.querySelector(".profile__image");s.getInitialCards().then((function(e){return t=e,n=document.querySelector(".places__list"),void t.forEach((function(e){var t=i(e,d._id,s.likeCard,s.removeCard,j,s.unLikeCard);n.appendChild(t)}));var t,n})).catch((function(e){return console.warn(e)}));var f=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_image"),m=document.querySelector(".popup_type_avatar");document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated")}));var h=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),S=f.querySelector(".popup__form"),q=S.querySelector(".popup__input_type_name"),k=S.querySelector(".popup__input_type_description"),L=document.querySelector(".profile__edit-button"),E=f.querySelector(".popup__close");L.addEventListener("click",R),E.addEventListener("click",(function(){return p(f)})),S.addEventListener("submit",(function(e){e.preventDefault();var t={name:q.value,about:k.value},n=e.target.querySelector(".popup__button");n.textContent="Сохранение...",s.editProfile(t).then((function(e){console.log(e),h.textContent=e.name,b.textContent=e.about,p(f)})).catch((function(e){return console.warn(e)})).finally((function(){n.textContent="Сохранить",I()}))}));var C=y.querySelector(".popup__form"),g=m.querySelector(".popup__form"),w=C.querySelector(".popup__input_type_card-name"),x=C.querySelector(".popup__input_type_url"),A=m.querySelector(".popup__input_type_url"),U=document.querySelector(".profile__add-button"),P=y.querySelector(".popup__close");function R(){q.value=h.textContent,k.value=b.textContent,l(f)}function T(){w.value="",x.value="",l(y)}function j(e){var t=v.querySelector(".popup__image"),n=v.querySelector(".popup__caption");t.src=e.link,t.alt=e.name,n.textContent=e.name,l(v)}function O(){var e=C.querySelector(".popup__button"),t=C.querySelector(".popup__input_type_card-name"),n=C.querySelector(".popup__input_type_url");t.validity.valid&&n.validity.valid?(e.removeAttribute("disabled"),e.classList.remove("popup__button_disabled")):(e.setAttribute("disabled","true"),e.classList.add("popup__button_disabled"))}function I(){var e=S.querySelector(".popup__button"),t=S.querySelector(".popup__input_type_name"),n=S.querySelector(".popup__input_type_description");t.validity.valid&&n.validity.valid?(e.removeAttribute("disabled"),e.classList.remove("popup__button_disabled")):(e.setAttribute("disabled","true"),e.classList.add("popup__button_disabled"))}function N(){var e=m.querySelector(".popup__button");m.querySelector(".popup__input_type_url").validity.valid?(e.removeAttribute("disabled"),e.classList.remove("popup__button_disabled")):(e.setAttribute("disabled","true"),e.classList.add("popup__button_disabled"))}U.addEventListener("click",T),P.addEventListener("click",(function(){return p(y)})),C.addEventListener("submit",(function(e){e.preventDefault();var t={name:w.value.trim(),link:x.value.trim()};if(t.name&&t.link){var n=e.target.querySelector(".popup__button");n.textContent="Сохранение...",s.addNewCard(t).then((function(e){var t=document.querySelector(".places__list"),n=i(e,d._id,s.likeCard,s.removeCard,j,s.unLikeCard);t.prepend(n),p(y),C.reset(),O()})).catch((function(e){return console.warn(e)})).finally((function(){n.textContent="Сохранить",O()}))}else alert("Заполните все поля формы!")})),g.addEventListener("submit",(function(e){e.preventDefault();var t=A.value.trim();if(t){var n=e.target.querySelector(".popup__button");n.textContent="Сохранение...",s.updateAvatar(t).then((function(t){e.target.reset(),_.style.backgroundImage='url("'.concat(t.avatar,'")'),p(m)})).catch((function(e){return console.warn(e)})).finally((function(){n.textContent="Сохранить",N()}))}else alert("Заполните все поля формы!")})),v.querySelector(".popup__close").addEventListener("click",(function(){return p(v)})),q.addEventListener("input",(function(){u(q),I()})),k.addEventListener("input",(function(){u(k),I()})),w.addEventListener("input",(function(){u(w),O()})),x.addEventListener("input",(function(){u(x),O()})),A.addEventListener("input",(function(){u(A),N()})),I(),O(),N(),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){return function(e,t){e.target===t&&p(t)}(t,e)}))})),f.querySelector(".popup__close").addEventListener("click",(function(){p(f),f.querySelectorAll("input").forEach((function(e){return c(e)}))})),y.querySelector(".popup__close").addEventListener("click",(function(){p(y),y.querySelectorAll("input").forEach((function(e){return c(e)}))})),v.querySelector(".popup__close").addEventListener("click",(function(){p(v),v.querySelectorAll("input").forEach((function(e){return c(e)}))})),m.querySelector(".popup__close").addEventListener("click",(function(){p(m),m.querySelectorAll("input").forEach((function(e){return c(e)})),m.querySelector("form").reset(),N()})),document.querySelector(".profile__edit-button").addEventListener("click",R),document.querySelector(".profile__add-button").addEventListener("click",T),s.getUserInfo().then((function(e){h.textContent=e.name,b.textContent=e.about,_.style.backgroundImage='url("'.concat(e.avatar,'")'),d._id=e._id})).catch((function(e){return console.warn(e)})),_.addEventListener("click",(function(){l(m)}))})();