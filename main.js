(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function c(e){e.validity.valid?function(e){var t=e.closest(".popup__form").querySelector(".popup__input-error_".concat(e.name));e.classList.remove("popup__input_type_error"),t.textContent="",t.classList.remove("popup__input-error_active")}(e):function(e,t){var n=e.closest(".popup__form").querySelector(".popup__input-error_".concat(e.name));e.classList.add("popup__input_type_error"),n.textContent=t,n.classList.add("popup__input-error_active")}(e,e.validationMessage)}function i(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&a(t)}}function u(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}var l=new(n((function e(t){var n=this,o=t.baseUrl,c=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"_checkResponse",(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),r(this,"getUserInfo",(function(){return fetch("".concat(n._baseUrl,"/users/me"),{headers:n._headers}).then(n._checkResponse)})),r(this,"getInitialCards",(function(){return fetch("".concat(n._baseUrl,"/cards"),{headers:n._headers}).then(n._checkResponse)})),r(this,"editProfile",(function(e){var t=e.name,r=e.about;return fetch("".concat(n._baseUrl,"/users/me"),{method:"PATCH",headers:n._headers,body:JSON.stringify({name:t,about:r})}).then(n._checkResponse)})),r(this,"addNewCard",(function(e){var t=e.name,r=e.link;return fetch("".concat(n._baseUrl,"/cards"),{method:"POST",headers:n._headers,body:JSON.stringify({name:t,link:r})}).then(n._checkResponse)})),r(this,"removeCard",(function(e){return fetch("".concat(n._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n._headers}).then(n._checkResponse)})),r(this,"likeCard",(function(e){return fetch("".concat(n._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n._headers}).then(n._checkResponse)})),r(this,"unLikeCard",(function(e){return fetch("".concat(n._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n._headers}).then(n._checkResponse)})),r(this,"updateAvatar",(function(e){return fetch("".concat(n._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n._headers,body:JSON.stringify({avatar:e})}).then(n._checkResponse)})),this._baseUrl=o,this._headers=c})))({baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"c48e611f-29c1-4a31-ba04-0a959f4c7417","Content-Type":"application/json"}}),p={_id:null},s=document.querySelector(".profile__image");function d(e,t,n,r,o){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__image"),a=c.querySelector(".card__title"),l=c.querySelector(".card__like-button"),p=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-counter");s.textContent=e.likes.length;var d=e.likes.find((function(e){return e._id===t}));return t!==e.owner._id&&p.remove(),d&&l.classList.add("card__like-button_is-active"),i.src=e.link,i.alt=e.name,a.textContent=e.name,l.addEventListener("click",(function(){d?o(e._id).then((function(e){console.log(e),d=!1,l.classList.remove("card__like-button_is-active"),s.textContent=e.likes.length})).catch((function(e){return console.warn(e)})):n(e._id).then((function(e){console.log(e),d=!0,l.classList.add("card__like-button_is-active"),s.textContent=e.likes.length})).catch((function(e){return console.warn(e)}))})),p&&p.addEventListener("click",(function(){r(e._id).then((function(e){console.log(e),c.remove()})).catch((function(e){return console.warn(e)}))})),i.addEventListener("click",(function(){!function(e){var t=v.querySelector(".popup__image"),n=v.querySelector(".popup__caption");t.src=e.link,t.alt=e.name,n.textContent=e.name,u(v)}(e)})),c}l.getInitialCards().then((function(e){return t=e,n=document.querySelector(".places__list"),void t.forEach((function(e){var t=d(e,p._id,l.likeCard,l.removeCard,l.unLikeCard);n.appendChild(t)}));var t,n})).catch((function(e){return console.warn(e)}));var _=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_image"),y=document.querySelector(".popup_type_avatar");document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated")}));var m=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),b=_.querySelector(".popup__form"),S=b.querySelector(".popup__input_type_name"),k=b.querySelector(".popup__input_type_description"),q=document.querySelector(".profile__edit-button"),L=_.querySelector(".popup__close");q.addEventListener("click",P),L.addEventListener("click",(function(){return a(_)})),b.addEventListener("submit",(function(e){e.preventDefault();var t={name:S.value,about:k.value},n=e.target.querySelector(".popup__button");n.textContent="Сохранение...",l.editProfile(t).then((function(e){console.log(e),m.textContent=e.name,h.textContent=e.about,a(_)})).catch((function(e){return console.warn(e)})).finally((function(){n.textContent="Сохранить"}))}));var E=f.querySelector(".popup__form"),C=y.querySelector(".popup__form"),g=E.querySelector(".popup__input_type_card-name"),w=E.querySelector(".popup__input_type_url"),x=y.querySelector(".popup__input_type_url"),U=document.querySelector(".profile__add-button"),A=f.querySelector(".popup__close");function P(){S.value=m.textContent,k.value=h.textContent,u(_)}function R(){g.value="",w.value="",u(f)}function T(){var e=E.querySelector(".popup__button"),t=E.querySelector(".popup__input_type_card-name"),n=E.querySelector(".popup__input_type_url");t.validity.valid&&n.validity.valid?(e.removeAttribute("disabled"),e.classList.remove("popup__button_disabled")):(e.setAttribute("disabled","true"),e.classList.add("popup__button_disabled"))}function j(){var e=b.querySelector(".popup__button"),t=b.querySelector(".popup__input_type_name"),n=b.querySelector(".popup__input_type_description");t.validity.valid&&n.validity.valid?(e.removeAttribute("disabled"),e.classList.remove("popup__button_disabled")):(e.setAttribute("disabled","true"),e.classList.add("popup__button_disabled"))}U.addEventListener("click",R),A.addEventListener("click",(function(){return a(f)})),E.addEventListener("submit",(function(e){e.preventDefault();var t={name:g.value.trim(),link:w.value.trim()};if(t.name&&t.link){var n=e.target.querySelector(".popup__button");n.textContent="Сохранение...",l.addNewCard(t).then((function(e){var t=document.querySelector(".places__list"),n=d(e,p._id,l.likeCard,l.removeCard,l.unLikeCard);t.prepend(n),a(f),E.reset()})).catch((function(e){return console.warn(e)})).finally((function(){n.textContent="Сохранить"}))}else alert("Заполните все поля формы!")})),C.addEventListener("submit",(function(e){e.preventDefault();var t=x.value.trim();if(t){var n=e.target.querySelector(".popup__button");n.textContent="Сохранение...",l.updateAvatar(t).then((function(t){s.style.backgroundImage='url("'.concat(t.avatar,'")'),a(y),e.target.reset()})).catch((function(e){return console.warn(e)})).finally((function(){n.textContent="Сохранить"}))}else alert("Заполните все поля формы!")})),v.querySelector(".popup__close").addEventListener("click",(function(){return a(v)})),S.addEventListener("input",(function(){c(S),j()})),k.addEventListener("input",(function(){c(k),j()})),g.addEventListener("input",(function(){c(g),T()})),w.addEventListener("input",(function(){c(w),T()})),x.addEventListener("input",(function(){var e;c(x),e=y.querySelector(".popup__button"),y.querySelector(".popup__input_type_url").validity.valid?(e.removeAttribute("disabled"),e.classList.remove("popup__button_disabled")):(e.setAttribute("disabled","true"),e.classList.add("popup__button_disabled"))})),j(),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){return function(e,t){e.target===t&&a(t)}(t,e)}))})),_.querySelector(".popup__close").addEventListener("click",(function(){return a(_)})),f.querySelector(".popup__close").addEventListener("click",(function(){return a(f)})),v.querySelector(".popup__close").addEventListener("click",(function(){return a(v)})),y.querySelector(".popup__close").addEventListener("click",(function(){return a(y)})),document.querySelector(".profile__edit-button").addEventListener("click",P),document.querySelector(".profile__add-button").addEventListener("click",R),l.getUserInfo().then((function(e){m.textContent=e.name,h.textContent=e.about,s.style.backgroundImage='url("'.concat(e.avatar,'")'),p._id=e._id})).catch((function(e){return console.warn(e)})),s.addEventListener("click",(function(){u(y)}))})();